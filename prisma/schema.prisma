generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  GUEST
  MANAGER
  ADMIN
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model User {
  id           String        @id @default(cuid())
  name         String
  email        String        @unique
  passwordHash String
  role         Role          @default(GUEST)

  reservations Reservation[]
  restaurants  Restaurant[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Restaurant {
  id           String   @id @default(cuid())
  name         String
  address      String
  description  String?
  workingHours String?

  managerId String
  manager   User     @relation(fields: [managerId], references: [id])

  tables    Table[]
  menuItems MenuItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Table {
  id         String @id @default(cuid())
  number     Int
  capacity   Int

  restaurantId String
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])

  reservations Reservation[]

  @@unique([restaurantId, number])
}

model MenuItem {
  id          String @id @default(cuid())
  name        String
  description String?
  price       Int
  type        String

  restaurantId String
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])

  orderItems OrderItem[]
}

model Reservation {
  id        String @id @default(cuid())

 
  dateTime  DateTime
  partySize Int
  status    ReservationStatus @default(PENDING)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  tableId String
  table   Table  @relation(fields: [tableId], references: [id])

  order Order?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tableId, dateTime])
  @@unique([userId, tableId, dateTime])
}

model Order {
  id            String @id @default(cuid())
  note          String?
  totalPrice    Int    @default(0)

  reservationId String @unique
  reservation   Reservation @relation(fields: [reservationId], references: [id])

  items OrderItem[]
}

model OrderItem {
  id         String @id @default(cuid())
  quantity   Int

  orderId String
  order   Order @relation(fields: [orderId], references: [id])

  menuItemId String
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])

  @@unique([orderId, menuItemId])
}
