generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  GUEST
  MANAGER
  ADMIN
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model User {
  id              Int      @id @default(autoincrement())
  ime             String
  email           String   @unique
  lozinka         String
  uloga           Role
  datumKreiranja  DateTime @default(now())

  reservations Reservation[]
  restaurants  Restaurant[]
}

model Restaurant {
  id              Int     @id @default(autoincrement())
  naziv           String
  adresa          String
  opis            String?
  radnoVreme      String
  administratorId Int

  administrator User @relation(fields: [administratorId], references: [id])

  tables    Table[]
  menuItems MenuItem[]
}

model Table {
  id            Int @id @default(autoincrement())
  brojStola     Int
  kapacitet     Int
  restoranId    Int

  restaurant   Restaurant @relation(fields: [restoranId], references: [id])
  reservations Reservation[]

  @@unique([restoranId, brojStola])
}

model MenuItem {
  id          Int     @id @default(autoincrement())
  naziv       String
  opis        String
  cena        Float
  tip         String
  restoranId  Int

  restaurant Restaurant @relation(fields: [restoranId], references: [id])
  orderItems OrderItem[]
}

model Reservation {
  id         Int      @id @default(autoincrement())
  dateTime   DateTime
  brojOsoba  Int
  status     String

  userId  Int
  tableId Int

  user  User  @relation(fields: [userId], references: [id])
  table Table @relation(fields: [tableId], references: [id])

  order Order?

  @@unique([userId, tableId, dateTime])
}

model Order {
  id             Int     @id @default(autoincrement())
  ukupnaCena     Float
  napomena       String?
  reservationId  Int     @unique

  reservation Reservation @relation(fields: [reservationId], references: [id])
  items        OrderItem[]
}

model OrderItem {
  id         Int @id @default(autoincrement())
  kolicina   Int
  orderId    Int
  menuItemId Int

  order     Order    @relation(fields: [orderId], references: [id])
  menuItem  MenuItem @relation(fields: [menuItemId], references: [id])

  @@unique([orderId, menuItemId])
}
